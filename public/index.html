<!DOCTYPE html>
<html ng-app="socketApp">
<head>
  <script  type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.8/p5.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.8/addons/p5.dom.js"></script>

  <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.3.15/angular.min.js"></script>
  <script src="angular-websocket/angular-websocket.js"></script>

<script>
    angular.module('socketApp', [
      'ngWebSocket' // you may also use 'angular-websocket' if you prefer
    ])
    .factory('PicData', function($websocket) {
      var dataStream = $websocket('ws://localhost:8081');
      var collection = [];
      dataStream.onMessage(function(message) {
        console.log(message);
        collection.push(message.data);
      });

      dataStream.onOpen(function(message) {
        console.log(message);
        dataStream.send("Hello server");
      });

      var methods = {
        collection: collection,
        get: function() {
          dataStream.send(JSON.stringify({ action: 'get' }));
        }
      };

      return methods;
    })
    .controller('SomeController', function ($scope, PicData) {
      $scope.MyData = PicData;
    });
  </script>

</head>
<body>
  <section ng-controller="SomeController">
    <ul>
      <li ng-repeat="data in MyData.collection track by $index">
        {{ data }}
      </li>
    </ul>
  </section>
</body>
</html>
